---
interface Skill {
  name: string;
  level: number;
}

interface Props {
  skills: Skill[];
}

const { skills } = Astro.props;
---

<section id="skills" class="py-16 px-4 sm:px-6 lg:px-8">
  <div class="max-w-6xl mx-auto">
    <div class="text-center mb-16">
      <h2 class="text-3xl sm:text-4xl font-bold text-white mb-4">Skills</h2>
      <div class="w-24 h-1 bg-gradient-to-r from-blue-400 to-purple-400 mx-auto"></div>
    </div>
    
    <!-- Skills Carousel -->
    <div class="relative">
      <!-- Carousel Container -->
      <div class="skills-carousel overflow-hidden">
        <div class="skills-track flex transition-transform duration-500 ease-in-out">
          {skills.map((skill, index) => (
            <div class="skill-card flex-shrink-0 w-80 mx-4 bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 hover:border-gray-600 transition-all duration-300">
              <div class="text-center">
                <!-- Skill Icon/Emoji -->
                <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-4">
                  <span class="text-2xl">
                    {skill.name.includes('JavaScript') ? 'âš¡' :
                     skill.name.includes('React') ? 'âš›ï¸' :
                     skill.name.includes('Node') ? 'ğŸŸ¢' :
                     skill.name.includes('Vue') ? 'ğŸ’š' :
                     skill.name.includes('Microservices') ? 'ğŸ”§' :
                     skill.name.includes('PostgreSQL') ? 'ğŸ˜' :
                     skill.name.includes('MongoDB') ? 'ğŸƒ' :
                     skill.name.includes('Docker') ? 'ğŸ³' :
                     skill.name.includes('Kubernetes') ? 'â˜¸ï¸' :
                     skill.name.includes('CI/CD') ? 'ğŸ”„' :
                     skill.name.includes('Terraform') ? 'ğŸ—ï¸' : 'ğŸ’»'}
                  </span>
                </div>
                
                <!-- Skill Name -->
                <h3 class="text-xl font-semibold text-white mb-3">{skill.name}</h3>
                
                <!-- Skill Level -->
                <div class="mb-4">
                  <div class="flex justify-between items-center mb-2">
                    <span class="text-sm text-gray-400">Proficiency</span>
                    <span class="text-sm font-medium text-blue-400">{skill.level}%</span>
                  </div>
                  <div class="w-full bg-gray-700 rounded-full h-3">
                    <div 
                      class="bg-gradient-to-r from-blue-400 to-purple-400 h-3 rounded-full transition-all duration-1000 ease-out" 
                      style={`width: ${skill.level}%`}
                    ></div>
                  </div>
                </div>
                
                <!-- Skill Level Text -->
                <div class="text-center">
                  <span class="text-sm text-gray-300">
                    {skill.level >= 90 ? 'Expert' :
                     skill.level >= 80 ? 'Advanced' :
                     skill.level >= 70 ? 'Intermediate' :
                     skill.level >= 60 ? 'Good' : 'Basic'}
                  </span>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
      
      <!-- Navigation Arrows -->
      <button 
        class="carousel-nav prev absolute left-0 top-1/2 transform -translate-y-1/2 bg-gray-800 hover:bg-gray-700 text-white p-3 rounded-full shadow-lg border border-gray-600 transition-all duration-300 z-10"
        aria-label="Previous skill"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>
      
      <button 
        class="carousel-nav next absolute right-0 top-1/2 transform -translate-y-1/2 bg-gray-800 hover:bg-gray-700 text-white p-3 rounded-full shadow-lg border border-gray-600 transition-all duration-300 z-10"
        aria-label="Next skill"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>
      
      <!-- Dots Indicator -->
      <div class="flex justify-center mt-8 space-x-2">
        {skills.map((_, index) => (
          <button 
            class="carousel-dot w-3 h-3 rounded-full bg-gray-600 hover:bg-gray-500 transition-all duration-300"
            data-index={index}
            aria-label={`Go to skill ${index + 1}`}
          ></button>
        ))}
      </div>
    </div>
    
    <!-- Skills Grid (Fallback for mobile) -->
    <div class="grid md:grid-cols-2 gap-6 mt-12 md:hidden">
      {skills.map(skill => (
        <div class="bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-700">
          <div class="flex justify-between items-center mb-2">
            <span class="font-medium text-white">{skill.name}</span>
            <span class="text-sm text-gray-400">{skill.level}%</span>
          </div>
          <div class="w-full bg-gray-700 rounded-full h-2">
            <div class="bg-gradient-to-r from-blue-400 to-purple-400 h-2 rounded-full transition-all duration-1000" style={`width: ${skill.level}%`}></div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const carousel = document.querySelector('.skills-carousel') as HTMLElement;
    const track = document.querySelector('.skills-track') as HTMLElement;
    const cards = document.querySelectorAll('.skill-card');
    const dots = document.querySelectorAll('.carousel-dot');
    const prevBtn = document.querySelector('.carousel-nav.prev') as HTMLElement;
    const nextBtn = document.querySelector('.carousel-nav.next') as HTMLElement;
    
    let currentIndex = 0;
    const cardWidth = 320; // w-80 = 320px
    const maxIndex = cards.length - 1;
    
    function updateTrack() {
      const translateX = -currentIndex * cardWidth;
      if (track) {
        track.style.transform = `translateX(${translateX}px)`;
      }
    }
    
    function updateDots() {
      dots.forEach((dot, index) => {
        if (index === currentIndex) {
          dot.classList.add('bg-blue-400');
          dot.classList.remove('bg-gray-600');
        } else {
          dot.classList.remove('bg-blue-400');
          dot.classList.add('bg-gray-600');
        }
      });
    }
    
    function updateNavigation() {
      if (prevBtn) {
        prevBtn.style.opacity = currentIndex === 0 ? '0.5' : '1';
        prevBtn.style.pointerEvents = currentIndex === 0 ? 'none' : 'auto';
      }
      
      if (nextBtn) {
        nextBtn.style.opacity = currentIndex === maxIndex ? '0.5' : '1';
        nextBtn.style.pointerEvents = currentIndex === maxIndex ? 'none' : 'auto';
      }
    }
    
    function goTo(index: number) {
      currentIndex = Math.max(0, Math.min(index, maxIndex));
      updateTrack();
      updateDots();
      updateNavigation();
    }
    
    function prev() {
      if (currentIndex > 0) {
        currentIndex--;
        updateTrack();
        updateDots();
        updateNavigation();
      }
    }
    
    function next() {
      if (currentIndex < maxIndex) {
        currentIndex++;
        updateTrack();
        updateDots();
        updateNavigation();
      }
    }
    
    // Bind events
    prevBtn?.addEventListener('click', prev);
    nextBtn?.addEventListener('click', next);
    
    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => goTo(index));
    });
    
    // Touch/swipe support
    let startX = 0;
    let endX = 0;
    
    carousel?.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
    });
    
    carousel?.addEventListener('touchend', (e) => {
      endX = e.changedTouches[0].clientX;
      const threshold = 50;
      const diff = startX - endX;
      
      if (Math.abs(diff) > threshold) {
        if (diff > 0) {
          next();
        } else {
          prev();
        }
      }
    });
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') prev();
      if (e.key === 'ArrowRight') next();
    });
    
    // Initialize
    updateDots();
    updateNavigation();
  });
</script>

<style>
  .skills-carousel {
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  
  .skills-carousel::-webkit-scrollbar {
    display: none;
  }
  
  .skill-card {
    min-height: 280px;
  }
  
  .skill-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
  }
  
  @media (max-width: 768px) {
    .carousel-nav {
      display: none;
    }
    
    .skills-carousel {
      display: none;
    }
  }
</style> 